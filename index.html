<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ Ğ°ĞºÑ†Ğ¸ÑĞ¼</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 10px; background-color: #f4f7f9; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .lang-switcher { text-align: center; margin-bottom: 20px; }
        .lang-switcher button { padding: 8px 15px; margin: 0 5px; border: 1px solid #3498db; background-color: #fff; color: #3498db; cursor: pointer; border-radius: 4px; font-size: 14px; }
        .lang-switcher button.active { background-color: #3498db; color: white; }
        h1 { color: #2c3e50; text-align: center; font-size: 1.8em; }
        .input-group { display: flex; margin-bottom: 20px; }
        #tickers-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px 0 0 4px; font-size: 16px; }
        #fetch-btn { padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 0 4px 4px 0; cursor: pointer; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; vertical-align: top; }
        th { background-color: #ecf0f1; color: #2c3e50; position: relative; }
        .price-plus { color: #27ae60; font-weight: bold; }
        .price-minus { color: #c0392b; font-weight: bold; }
        #period-select { font-size: 12px; padding: 2px; border-radius: 4px; border: 1px solid #ccc; }
        .tooltip-text { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background-color: #34495e; color: white; padding: 8px 12px; border-radius: 5px; font-size: 12px; font-weight: normal; width: 250px; text-align: center; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0.2s ease; z-index: 10; }
        th:hover .tooltip-text { opacity: 1; visibility: visible; }
        body.rtl { direction: rtl; } body.rtl th, body.rtl td { text-align: right; }
        @media screen and (max-width: 768px) {
            thead { display: none; }
            tr { margin-bottom: 15px; border: 1px solid #ddd; }
            table, tbody, th, td, tr { display: block; }
            td { border: none; border-bottom: 1px solid #eee; position: relative; padding-left: 50%; text-align: right; }
            td:before { position: absolute; top: 12px; left: 12px; width: 45%; content: attr(data-label); font-weight: bold; text-align: left;}
            td:first-of-type { background-color: #ecf0f1; font-weight: bold; font-size: 1.2em; padding-left: 12px; }
            td:first-of-type:before { display: none; }
            body.rtl td { text-align: left; padding-left: 0; padding-right: 50%;}
            body.rtl td:before { right: 12px; left: auto; text-align: right;}
            body.rtl td:first-of-type { padding-right: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lang-switcher">
            <button id="lang-en">English</button>
            <button id="lang-ru" class="active">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
            <button id="lang-he">×¢×‘×¨×™×ª</button>
        </div>
        <h1 data-lang-key="title"></h1>
        <p data-lang-key="subtitle"></p>
        <div class="input-group">
            <input type="text" id="tickers-input" data-lang-key-placeholder="placeholder">
            <button id="fetch-btn" data-lang-key="fetch_btn"></button>
        </div>
        <div id="loader" class="loader" data-lang-key="loader"></div>
        <table id="stock-table">
            <thead>
                <tr>
                    <th data-lang-key="h_ticker" data-tooltip-key="e_ticker"></th>
                    <th data-lang-key="h_price" data-tooltip-key="e_price"></th>
                    <th>
                        <span data-lang-key="h_change"></span>
                        <select id="period-select">
                            <option value="today" data-lang-key="p_today"></option>
                            <option value="week" data-lang-key="p_week"></option>
                            <option value="month" data-lang-key="p_month"></option>
                            <option value="1Y" data-lang-key="p_1y"></option>
                            <option value="5Y" data-lang-key="p_5y"></option>
                        </select>
                    </th>
                    <th data-lang-key="h_market_cap" data-tooltip-key="e_market_cap"></th>
                    <th data-lang-key="h_pe" data-tooltip-key="e_pe"></th>
                    <th data-lang-key="h_pb" data-tooltip-key="e_pb"></th>
                    <th data-lang-key="h_ps" data-tooltip-key="e_ps"></th>
                    <th data-lang-key="h_eps" data-tooltip-key="e_eps"></th>
                    <th data-lang-key="h_roe" data-tooltip-key="e_roe"></th>
                    <th data-lang-key="h_roa" data-tooltip-key="e_roa"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        let tickersOnScreen = [];
        const translations = {
            en: { title: 'Stock Analysis ğŸ“ˆ', subtitle: 'Enter tickers separated by commas (e.g., AAPL, MSFT, LUMI.TA).', placeholder: 'AAPL,MSFT,LUMI.TA', fetch_btn: 'Get Data', loader: 'Loading...', h_ticker: 'Ticker', h_price: 'Price', h_change: 'Change', h_market_cap: 'Market Cap', h_pe: 'P/E', h_pb: 'P/B', h_ps: 'P/S', h_eps: 'EPS', h_roe: 'ROE %', h_roa: 'ROA %', e_ticker: 'Stock symbol.', e_price: 'Price from the last trading day.', e_market_cap: 'Market Capitalization. <b>Bigger = Larger company.</b>', e_pe: 'Price / Earnings. <b>Lower is better.</b>', e_pb: 'Price / Book Value. <b>Lower (esp. <1) is better.</b>', e_ps: 'Price / Sales. <b>Lower is better.</b>', e_eps: 'Earnings Per Share. <b>Higher is better.</b>', e_roe: 'Return On Equity. <b>Higher is better.</b>', e_roa: 'Return On Assets. <b>Higher is better.</b>', p_today: 'Today', p_week: 'Week', p_month: 'Month', p_1y: 'Year', p_5y: '5 years', alert_no_ticker: 'Please enter at least one ticker.', error_fetch: 'Failed to load data.' },
            ru: { title: 'ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ°ĞºÑ†Ğ¸Ğ¹ ğŸ“ˆ', subtitle: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚Ğ¸ĞºĞµÑ€Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: AAPL, MSFT, LUMI.TA).', placeholder: 'AAPL,MSFT,LUMI.TA', fetch_btn: 'ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ', loader: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...', h_ticker: 'Ğ¢Ğ¸ĞºĞµÑ€', h_price: 'Ğ¦ĞµĞ½Ğ°', h_change: 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ', h_market_cap: 'Market Cap', h_pe: 'P/E', h_pb: 'P/B', h_ps: 'P/S', h_eps: 'EPS', h_roe: 'ROE %', h_roa: 'ROA %', e_ticker: 'Ğ¡Ğ¸Ğ¼Ğ²Ğ¾Ğ» Ğ°ĞºÑ†Ğ¸Ğ¸.', e_price: 'Ğ¦ĞµĞ½Ğ° Ğ¿Ğ¾ Ğ¸Ñ‚Ğ¾Ğ³Ğ°Ğ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ñ‚Ğ¾Ñ€Ğ³. Ğ´Ğ½Ñ.', e_market_cap: 'Ğ Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ğ°Ñ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ. <b>Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ = ĞºÑ€ÑƒĞ¿Ğ½ĞµĞµ.</b>', e_pe: 'Ğ¦ĞµĞ½Ğ° / ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ. <b>Ğ§ĞµĞ¼ Ğ½Ğ¸Ğ¶Ğµ, Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', e_pb: 'Ğ¦ĞµĞ½Ğ° / Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ. ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ. <b>Ğ§ĞµĞ¼ Ğ½Ğ¸Ğ¶Ğµ (Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ <1), Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', e_ps: 'Ğ¦ĞµĞ½Ğ° / Ğ’Ñ‹Ñ€ÑƒÑ‡ĞºĞ°. <b>Ğ§ĞµĞ¼ Ğ½Ğ¸Ğ¶Ğµ, Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', e_eps: 'ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ Ğ½Ğ° Ğ°ĞºÑ†Ğ¸Ñ. <b>Ğ§ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', e_roe: 'Ğ ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»Ğ°. <b>Ğ§ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', e_roa: 'Ğ ĞµĞ½Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¾Ğ². <b>Ğ§ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ, Ñ‚ĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞµ.</b>', p_today: 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ', p_week: 'ĞĞµĞ´ĞµĞ»Ñ', p_month: 'ĞœĞµÑÑÑ†', p_1y: 'Ğ“Ğ¾Ğ´', p_5y: '5 Ğ»ĞµÑ‚', alert_no_ticker: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¸ĞºĞµÑ€.', error_fetch: 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.' },
            he: { title: '× ×™×ª×•×— ×× ×™×•×ª ğŸ“ˆ', subtitle: '×”×–×Ÿ ×¡×™××‘×•×œ×™× ×‘× ×¤×¨×“ ×¤×¡×™×§ (×œ×“×•×’××”: AAPL, MSFT, LUMI.TA).', placeholder: 'AAPL,MSFT,LUMI.TA', fetch_btn: '×§×‘×œ × ×ª×•× ×™×', loader: '×˜×•×¢×Ÿ...', h_ticker: '×¡×™××‘×•×œ', h_price: '××—×™×¨', h_change: '×©×™× ×•×™', h_market_cap: '×©×•×•×™ ×©×•×§', h_pe: '××›×¤×™×œ ×¨×•×•×—', h_pb: '××›×¤×™×œ ×”×•×Ÿ', h_ps: '××›×¤×™×œ ××›×™×¨×•×ª', h_eps: '×¨×•×•×— ×œ×× ×™×”', h_roe: '×ª×©×•××” ×œ×”×•×Ÿ', h_roa: '×ª×©×•××” ×œ× ×›×¡×™×', e_ticker: '×¡×™××•×œ ×”×× ×™×”.', e_price: '××—×™×¨ ××™×•× ×”××¡×—×¨ ×”××—×¨×•×Ÿ.', e_market_cap: '×©×•×•×™ ×©×•×§. <b>×’×“×•×œ ×™×•×ª×¨ = ×—×‘×¨×” ×’×“×•×œ×” ×™×•×ª×¨.</b>', e_pe: '××—×™×¨ / ×¨×•×•×—. <b>× ××•×š ×™×•×ª×¨ ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', e_pb: '××—×™×¨ / ×”×•×Ÿ ×¢×¦××™. <b>× ××•×š ×™×•×ª×¨ (×‘××™×•×—×“ <1) ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', e_ps: '××—×™×¨ / ××›×™×¨×•×ª. <b>× ××•×š ×™×•×ª×¨ ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', e_eps: '×¨×•×•×— ×œ×× ×™×”. <b>×’×‘×•×” ×™×•×ª×¨ ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', e_roe: '×ª×©×•××” ×œ×”×•×Ÿ ×”×¢×¦××™. <b>×’×‘×•×” ×™×•×ª×¨ ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', e_roa: '×ª×©×•××” ×¢×œ ×”× ×›×¡×™×. <b>×’×‘×•×” ×™×•×ª×¨ ×–×” ×˜×•×‘ ×™×•×ª×¨.</b>', p_today: '×”×™×•×', p_week: '×©×‘×•×¢', p_month: '×—×•×“×©', p_1y: '×©× ×”', p_5y: '5 ×©× ×™×', alert_no_ticker: '×× × ×”×–×Ÿ ×œ×¤×—×•×ª ×¡×™××‘×•×œ ××—×“.', error_fetch: '×˜×¢×™× ×ª ×”× ×ª×•× ×™× × ×›×©×œ×”.' }
        };
        let currentLang = 'ru';

        function setLanguage(lang) {
            currentLang = lang; document.documentElement.lang = lang; document.body.classList.toggle('rtl', lang === 'he'); const langDict = translations[lang];
            document.querySelectorAll('[data-lang-key]').forEach(elem => { if (['TH', 'SPAN', 'OPTION'].includes(elem.tagName)) { elem.textContent = langDict[elem.getAttribute('data-lang-key')]; } else { elem.innerHTML = langDict[elem.getAttribute('data-lang-key')]; } });
            document.querySelectorAll('[data-lang-key-placeholder]').forEach(elem => { elem.placeholder = langDict[elem.getAttribute('data-lang-key-placeholder')]; });
            document.querySelectorAll('th[data-tooltip-key]').forEach(elem => { elem.innerHTML = `${langDict[elem.getAttribute('data-lang-key')]}<span class="tooltip-text">${langDict[elem.getAttribute('data-tooltip-key')]}</span>`; });
            document.querySelectorAll('.lang-switcher button').forEach(btn => { btn.classList.remove('active'); }); document.getElementById(`lang-${lang}`).classList.add('active');
        }

        async function fetchData(tickers) {
            const tableBody = document.querySelector('#stock-table tbody');
            const loader = document.getElementById('loader');
            const period = document.getElementById('period-select').value;
            tableBody.innerHTML = ''; loader.style.display = 'block';

            for (const ticker of tickers) {
                const langHeaders = translations[currentLang];
                let row = `<tr><td data-label="${langHeaders.h_ticker}"><strong>${ticker}</strong></td>`;
                try {
                    const response = await fetch(`/.netlify/functions/fetchData?ticker=${ticker}&period=${period}`);
                    if (!response.ok) throw new Error(`Server error for ${ticker}`);
                    const data = await response.json();
                    if (data.error) throw new Error(data.error);

                    const { price, changeHtml, marketCap, peRatio, pbRatio, psRatio, eps, roe, roa } = data;
                    row += `<td data-label="${langHeaders.h_price}">${price}</td> <td data-label="${langHeaders.h_change}">${changeHtml}</td> <td data-label="${langHeaders.h_market_cap}">${marketCap}</td> <td data-label="${langHeaders.h_pe}">${peRatio}</td> <td data-label="${langHeaders.h_pb}">${pbRatio}</td> <td data-label="${langHeaders.h_ps}">${psRatio}</td> <td data-label="${langHeaders.h_eps}">${eps}</td> <td data-label="${langHeaders.h_roe}">${roe}</td> <td data-label="${langHeaders.h_roa}">${roa}</td>`;
                } catch (error) {
                    console.error(`Failed to load data for ${ticker}:`, error);
                    row += `<td colspan="9" data-label="Error">${translations[currentLang].error_fetch}</td>`;
                } finally {
                    row += `</tr>`; tableBody.innerHTML += row;
                    if (tableBody.children.length === tickers.length) { loader.style.display = 'none'; }
                }
            }
        }
        document.getElementById('lang-en').addEventListener('click', () => setLanguage('en')); document.getElementById('lang-ru').addEventListener('click', () => setLanguage('ru')); document.getElementById('lang-he').addEventListener('click', () => setLanguage('he'));
        document.getElementById('fetch-btn').addEventListener('click', () => {
            tickersOnScreen = document.getElementById('tickers-input').value.split(',').map(t => t.trim().toUpperCase()).filter(t => t);
            if (tickersOnScreen.length === 0) { alert(translations[currentLang].alert_no_ticker); return; }
            fetchData(tickersOnScreen);
        });
        document.getElementById('period-select').addEventListener('change', () => { if (tickersOnScreen.length > 0) { fetchData(tickersOnScreen); } });
        setLanguage(currentLang);
    </script>
</body>
</html>
